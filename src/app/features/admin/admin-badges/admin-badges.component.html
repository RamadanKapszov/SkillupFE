<div class="badges-page">
  <div class="header">
    <div>
      <h2>üèÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –±–∞–¥–∂–æ–≤–µ</h2>
      <p>–î–æ–±–∞–≤—è–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–π –∏ –∏–∑—Ç—Ä–∏–≤–∞–π –±–∞–¥–∂–æ–≤–µ.</p>
    </div>

    <button class="btn primary" (click)="openCreate()">‚ûï –ù–æ–≤ –±–∞–¥–∂</button>
  </div>

  <div class="toolbar">
    <input type="text" placeholder="üîç –¢—ä—Ä—Å–∏ –ø–æ –∏–º–µ..." [(ngModel)]="search" />
    <span class="count">{{ filteredBadges.length }} –±–∞–¥–∂–∞</span>
  </div>

  <div *ngIf="loading" class="loading-block">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...</div>

  <table class="badges-table" *ngIf="!loading && filteredBadges.length > 0">
    <thead>
      <tr>
        <th>–ò–∫–æ–Ω–∞</th>
        <th>–ò–º–µ</th>
        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
        <th>–£—Å–ª–æ–≤–∏–µ</th>
        <th>–ü—Ä–∞–≥</th>
        <th class="actions">–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let b of filteredBadges">
        <td>
          <img *ngIf="b.iconUrl; else noIcon" [src]="b.iconUrl" class="icon" />
          <ng-template #noIcon>‚Äî</ng-template>
        </td>
        <td>{{ b.name }}</td>
        <td>{{ b.description || "-" }}</td>
        <td>{{ b.conditionType || "-" }}</td>
        <td>{{ b.threshold ?? "-" }}</td>

        <td class="actions">
          <button class="btn ghost" (click)="openEdit(b)">‚úèÔ∏è</button>
          <button class="btn danger" (click)="deleteBadge(b)">üóëÔ∏è</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && filteredBadges.length === 0" class="empty">
    –ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –±–∞–¥–∂–æ–≤–µ.
  </div>

  <!-- CREATE MODAL -->
  <div class="modal-backdrop" *ngIf="showCreateModal" (click)="closeCreate()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>‚ûï –ù–æ–≤ –±–∞–¥–∂</h3>

      <form [formGroup]="createForm" (ngSubmit)="createBadge()">
        <label>
          <span>–ò–º–µ*</span>
          <input type="text" formControlName="name" />
        </label>

        <label>
          <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
          <textarea rows="2" formControlName="description"></textarea>
        </label>

        <label>
          <span>–¢–∏–ø —É—Å–ª–æ–≤–∏–µ</span>
          <select formControlName="conditionType">
            <option value="">-- –∏–∑–±–µ—Ä–∏ --</option>
            <option value="POINTS">–¢–æ—á–∫–∏</option>
            <option value="LESSONS_COMPLETED">–ó–∞–≤—ä—Ä—à–µ–Ω–∏ —É—Ä–æ—Ü–∏</option>
            <option value="TESTS_COMPLETED">–ó–∞–≤—ä—Ä—à–µ–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ</option>
          </select>
        </label>

        <label>
          <span>–ü—Ä–∞–≥ (threshold)</span>
          <input type="number" formControlName="threshold" />
        </label>

        <label>
          <span>Icon URL</span>
          <input type="text" formControlName="iconUrl" />
        </label>

        <div class="modal-actions">
          <button type="button" class="btn ghost" (click)="closeCreate()">
            –û—Ç–∫–∞–∑
          </button>

          <button
            type="submit"
            class="btn primary"
            [disabled]="createForm.invalid || submitting"
          >
            {{ submitting ? "–°—ä–∑–¥–∞–≤–∞–Ω–µ..." : "–°—ä–∑–¥–∞–π" }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- EDIT MODAL -->
  <div class="modal-backdrop" *ngIf="showEditModal" (click)="closeEdit()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ</h3>

      <form [formGroup]="editForm" (ngSubmit)="updateBadge()">
        <label>
          <span>–ò–º–µ*</span>
          <input type="text" formControlName="name" />
        </label>

        <label>
          <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
          <textarea rows="2" formControlName="description"></textarea>
        </label>

        <label>
          <span>–¢–∏–ø —É—Å–ª–æ–≤–∏–µ</span>
          <select formControlName="conditionType">
            <option value="">-- –∏–∑–±–µ—Ä–∏ --</option>
            <option value="POINTS">–¢–æ—á–∫–∏</option>
            <option value="LESSONS_COMPLETED">–ó–∞–≤—ä—Ä—à–µ–Ω–∏ —É—Ä–æ—Ü–∏</option>
            <option value="TESTS_COMPLETED">–ó–∞–≤—ä—Ä—à–µ–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ</option>
          </select>
        </label>

        <label>
          <span>–ü—Ä–∞–≥ (threshold)</span>
          <input type="number" formControlName="threshold" />
        </label>

        <label>
          <span>Icon URL</span>
          <input type="text" formControlName="iconUrl" />
        </label>

        <div class="modal-actions">
          <button type="button" class="btn ghost" (click)="closeEdit()">
            –û—Ç–∫–∞–∑
          </button>

          <button
            type="submit"
            class="btn primary"
            [disabled]="editForm.invalid || submitting"
          >
            {{ submitting ? "–ó–∞–ø–∞–∑–≤–∞–Ω–µ..." : "–ó–∞–ø–∞–∑–∏" }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
