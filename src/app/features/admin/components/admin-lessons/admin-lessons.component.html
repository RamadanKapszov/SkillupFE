<div class="admin-lessons-page">
  <!-- ================= LEFT: COURSES ================= -->
  <aside class="courses-panel">
    <div class="panel-header">
      <h2>üìö –ö—É—Ä—Å–æ–≤–µ</h2>
      <p>–ò–∑–±–µ—Ä–∏ –∫—É—Ä—Å, –∑–∞ –¥–∞ —É–ø—Ä–∞–≤–ª—è–≤–∞—à –Ω–µ–≥–æ–≤–∏—Ç–µ —É—Ä–æ—Ü–∏.</p>
    </div>

    <div class="search-box">
      <input
        type="text"
        placeholder="üîç –¢—ä—Ä—Å–∏ –∫—É—Ä—Å..."
        [(ngModel)]="courseSearch"
        (input)="filterCourses()"
      />
    </div>

    <div class="courses-list" *ngIf="!coursesLoading; else loadingCoursesTpl">
      <div
        class="course-item"
        *ngFor="let c of filteredCourses"
        [class.active]="selectedCourse?.id === c.id"
        (click)="selectCourse(c)"
      >
        <div class="course-title">{{ c.title }}</div>
        <div class="course-meta">
          <span>{{ c.level || "–í—Å–∏—á–∫–∏ –Ω–∏–≤–∞" }}</span>
          <span>{{ c.language || "BG" }}</span>
        </div>
      </div>

      <div *ngIf="filteredCourses.length === 0" class="empty-state small">
        –ù—è–º–∞ –∫—É—Ä—Å–æ–≤–µ –ø–æ —Ç–æ–∑–∏ —Ñ–∏–ª—Ç—ä—Ä.
      </div>
    </div>

    <ng-template #loadingCoursesTpl>
      <div class="loading-block">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫—É—Ä—Å–æ–≤–µ—Ç–µ...</div>
    </ng-template>
  </aside>

  <!-- ================= RIGHT: LESSONS ================= -->
  <section class="lessons-panel">
    <div class="lessons-header">
      <div class="left">
        <h2>
          üìò
          {{
            selectedCourse
              ? "–£—Ä–æ—Ü–∏ –≤: " + selectedCourse.title
              : "–ò–∑–±–µ—Ä–µ—Ç–µ –∫—É—Ä—Å"
          }}
        </h2>
        <p *ngIf="selectedCourse">
          –£–ø—Ä–∞–≤–ª—è–≤–∞–π —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ –∑–∞ —Ç–æ–∑–∏ –∫—É—Ä—Å ‚Äì –¥–æ–±–∞–≤—è–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–π –∏ –∏–∑—Ç—Ä–∏–≤–∞–π
          —É—Ä–æ—Ü–∏.
        </p>
      </div>

      <div class="right">
        <button
          class="btn primary"
          (click)="openCreate()"
          [disabled]="!selectedCourse"
        >
          ‚ûï –ù–æ–≤ —É—Ä–æ–∫
        </button>
      </div>
    </div>

    <div *ngIf="!selectedCourse" class="empty-state">
      <p>–ò–∑–±–µ—Ä–µ—Ç–µ –∫—É—Ä—Å –æ—Ç–ª—è–≤–æ, –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —É—Ä–æ—Ü–∏—Ç–µ –º—É.</p>
    </div>

    <ng-container *ngIf="selectedCourse">
      <div class="lessons-toolbar">
        <input
          type="text"
          placeholder="üîç –¢—ä—Ä—Å–∏ —É—Ä–æ–∫ –ø–æ –∑–∞–≥–ª–∞–≤–∏–µ..."
          [(ngModel)]="lessonSearch"
        />
        <span class="count-badge"> {{ filteredLessons.length }} —É—Ä–æ–∫–∞ </span>
      </div>

      <!-- Lessons Table / Cards -->
      <div
        class="lessons-table-wrapper"
        *ngIf="!lessonsLoading; else loadingLessonsTpl"
      >
        <table class="lessons-table" *ngIf="filteredLessons.length > 0">
          <thead>
            <tr>
              <th>#</th>
              <th>–ó–∞–≥–ª–∞–≤–∏–µ</th>
              <th>–†–µ–¥</th>
              <th>–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç</th>
              <th>–í–∏–¥–µ–æ / –õ–∏–Ω–∫</th>
              <th class="actions-col">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let l of filteredLessons; let i = index">
              <td>{{ i + 1 }}</td>
              <td class="title-cell">
                {{ l.title }}
                <div class="desc" *ngIf="l.description">
                  {{ l.description }}
                </div>
              </td>
              <td>{{ l.orderIndex || "-" }}</td>
              <td>
                <span *ngIf="l.duration; else noDurationTpl">
                  {{ l.duration }} –º–∏–Ω.
                </span>
                <ng-template #noDurationTpl>‚Äì</ng-template>
              </td>
              <td>
                <span *ngIf="l.contentUrl; else noLinkTpl">‚úÖ –ò–º–∞ –≤–∏–¥–µ–æ</span>
                <ng-template #noLinkTpl>‚Äî</ng-template>
              </td>
              <td class="actions-col">
                <button class="btn ghost" (click)="openEdit(l)">
                  ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π
                </button>
                <button class="btn danger" (click)="deleteLesson(l)">
                  üóëÔ∏è –ò–∑—Ç—Ä–∏–π
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div *ngIf="filteredLessons.length === 0" class="empty-state">
          –ù—è–º–∞ —Å—ä–∑–¥–∞–¥–µ–Ω–∏ —É—Ä–æ—Ü–∏ –∑–∞ —Ç–æ–∑–∏ –∫—É—Ä—Å.
        </div>
      </div>

      <ng-template #loadingLessonsTpl>
        <div class="loading-block">–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —É—Ä–æ—Ü–∏—Ç–µ...</div>
      </ng-template>
    </ng-container>
  </section>

  <!-- ============== CREATE MODAL ============== -->
  <div class="modal-backdrop" *ngIf="showCreateModal" (click)="closeCreate()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>‚ûï –ù–æ–≤ —É—Ä–æ–∫</h3>
      <p class="muted">
        –°—ä–∑–¥–∞–π—Ç–µ –Ω–æ–≤ —É—Ä–æ–∫ –∑–∞ –∫—É—Ä—Å–∞:
        <strong>{{ selectedCourse?.title }}</strong>
      </p>

      <form [formGroup]="createForm" (ngSubmit)="createLesson()">
        <div class="form-grid">
          <label>
            <span>–ó–∞–≥–ª–∞–≤–∏–µ*</span>
            <input type="text" formControlName="title" />
          </label>

          <label>
            <span>–†–µ–¥ (orderIndex)</span>
            <input type="number" formControlName="orderIndex" />
          </label>
        </div>

        <label>
          <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
          <textarea rows="3" formControlName="description"></textarea>
        </label>

        <div class="form-grid">
          <label>
            <span>–í–∏–¥–µ–æ / —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ (URL)</span>
            <input type="url" formControlName="contentUrl" />
          </label>

          <label>
            <span>–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç (–º–∏–Ω.)</span>
            <input type="number" formControlName="duration" />
          </label>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn ghost" (click)="closeCreate()">
            –û—Ç–∫–∞–∑
          </button>
          <button
            type="submit"
            class="btn primary"
            [disabled]="createForm.invalid || submitting"
          >
            {{ submitting ? "–°—ä–∑–¥–∞–≤–∞–Ω–µ..." : "–°—ä–∑–¥–∞–π" }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ============== EDIT MODAL ============== -->
  <div class="modal-backdrop" *ngIf="showEditModal" (click)="closeEdit()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —É—Ä–æ–∫</h3>
      <p class="muted">
        –û–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è—Ç–∞ –∑–∞:
        <strong>{{ selectedLesson?.title }}</strong>
      </p>

      <form [formGroup]="editForm" (ngSubmit)="updateLesson()">
        <div class="form-grid">
          <label>
            <span>–ó–∞–≥–ª–∞–≤–∏–µ*</span>
            <input type="text" formControlName="title" />
          </label>

          <label>
            <span>–†–µ–¥ (orderIndex)</span>
            <input type="number" formControlName="orderIndex" />
          </label>
        </div>

        <label>
          <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
          <textarea rows="3" formControlName="description"></textarea>
        </label>

        <div class="form-grid">
          <label>
            <span>–í–∏–¥–µ–æ / —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ (URL)</span>
            <input type="url" formControlName="contentUrl" />
          </label>

          <label>
            <span>–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç (–º–∏–Ω.)</span>
            <input type="number" formControlName="duration" />
          </label>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn ghost" (click)="closeEdit()">
            –û—Ç–∫–∞–∑
          </button>
          <button
            type="submit"
            class="btn primary"
            [disabled]="editForm.invalid || submitting"
          >
            {{ submitting ? "–ó–∞–ø–∞–∑–≤–∞–Ω–µ..." : "–ó–∞–ø–∞–∑–∏" }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
