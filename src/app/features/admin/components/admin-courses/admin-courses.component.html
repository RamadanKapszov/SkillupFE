<div class="page-header">
  <div>
    <h1>üìö Courses Management</h1>
    <p class="subtitle">
      –ü—Ä–µ–≥–ª–µ–∂–¥–∞–π –∏ —É–ø—Ä–∞–≤–ª—è–≤–∞–π –≤—Å–∏—á–∫–∏ –∫—É—Ä—Å–æ–≤–µ –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ç–∞.
    </p>
  </div>

  <div class="search-box">
    <input
      type="text"
      placeholder="üîç –¢—ä—Ä—Å–∏ –ø–æ –∑–∞–≥–ª–∞–≤–∏–µ..."
      [(ngModel)]="q"
      (input)="onSearchChange()"
    />
  </div>
</div>

<div class="card" *ngIf="!loading; else loadingTpl">
  <table class="courses-table" *ngIf="courses.length; else emptyTpl">
    <thead>
      <tr>
        <th>ID</th>
        <th>–ö—É—Ä—Å</th>
        <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
        <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª</th>
        <th>–°—Ç—É–¥–µ–Ω—Ç–∏</th>
        <th>–†–µ–π—Ç–∏–Ω–≥</th>
        <th>–°—ä–∑–¥–∞–¥–µ–Ω</th>
        <th class="col-actions"></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let c of courses">
        <td>{{ c.id }}</td>
        <td>
          <div class="course-cell">
            <div class="thumb">
              <img
                [src]="c.imageUrl || 'assets/images/default-course.jpg'"
                alt="{{ c.title }}"
              />
            </div>
            <div>
              <div class="title">{{ c.title }}</div>
              <div class="short" *ngIf="c.shortDescription">
                {{ c.shortDescription }}
              </div>
            </div>
          </div>
        </td>
        <td>{{ c.categoryName || "‚Äî" }}</td>
        <td>{{ c.teacherUsername || "‚Äî" }}</td>
        <td>
          {{ c.studentsCount ?? c.studentsCount === 0 ? c.studentsCount : 0 }}
        </td>
        <td>{{ c.averageRating ?? c.rating ?? 0 | number : "1.1-1" }}</td>
        <td>{{ c.createdAt | date : "dd.MM.yyyy" }}</td>
        <td class="actions">
          <button class="btn ghost" (click)="viewCourse(c.id)">
            üëÅÔ∏è –ü—Ä–µ–≥–ª–µ–¥
          </button>
          <button class="btn" (click)="openEdit(c)">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>
          <button class="btn danger" (click)="openDelete(c)">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages() > 1">
    <button (click)="prevPage()" [disabled]="page === 1">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
    <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page }} –æ—Ç {{ totalPages() }}</span>
    <button (click)="nextPage()" [disabled]="page === totalPages()">
      –ù–∞–ø—Ä–µ–¥ ‚û°Ô∏è
    </button>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading">‚è≥ –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –∫—É—Ä—Å–æ–≤–µ...</div>
</ng-template>

<ng-template #emptyTpl>
  <div class="empty-state">
    <p>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –∫—É—Ä—Å–æ–≤–µ.</p>
  </div>
</ng-template>

<!-- ‚úèÔ∏è Edit modal -->
<div class="modal-backdrop" *ngIf="showEditModal">
  <div class="modal" (click)="$event.stopPropagation()">
    <h3>–†–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –∫—É—Ä—Å</h3>

    <label>
      <span>–ó–∞–≥–ª–∞–≤–∏–µ</span>
      <input [(ngModel)]="selectedCourse.title" />
    </label>

    <label>
      <span>–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ</span>
      <input [(ngModel)]="selectedCourse.shortDescription" />
    </label>

    <label>
      <span>–û–ø–∏—Å–∞–Ω–∏–µ</span>
      <textarea [(ngModel)]="selectedCourse.description" rows="3"></textarea>
    </label>

    <div class="grid">
      <label>
        <span>–ù–∏–≤–æ</span>
        <input [(ngModel)]="selectedCourse.level" />
      </label>
      <label>
        <span>–ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç</span>
        <input [(ngModel)]="selectedCourse.duration" />
      </label>
    </div>

    <div class="grid">
      <label>
        <span>–ï–∑–∏–∫</span>
        <input [(ngModel)]="selectedCourse.language" />
      </label>
      <label>
        <span>–ö–∞—Ç–µ–≥–æ—Ä–∏—è ID</span>
        <input type="number" [(ngModel)]="selectedCourse.categoryId" />
      </label>
    </div>

    <label>
      <span>Image URL</span>
      <input [(ngModel)]="selectedCourse.imageUrl" />
    </label>

    <label>
      <span>–¢–∞–≥–æ–≤–µ</span>
      <input [(ngModel)]="selectedCourse.tags" />
    </label>

    <div class="modal-actions">
      <button class="btn ghost" (click)="showEditModal = false">–û—Ç–∫–∞–∂–∏</button>
      <button class="btn primary" (click)="saveEdit()">–ó–∞–ø–∞–∑–∏</button>
    </div>
  </div>
</div>

<!-- üóëÔ∏è Delete modal -->
<div class="modal-backdrop" *ngIf="showDeleteModal">
  <div class="modal" (click)="$event.stopPropagation()">
    <h3>–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫—É—Ä—Å</h3>
    <p>
      –°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ
      <strong>{{ selectedCourse?.title }}</strong
      >?
    </p>

    <div class="modal-actions">
      <button class="btn ghost" (click)="showDeleteModal = false">
        –û—Ç–∫–∞–∂–∏
      </button>
      <button class="btn danger" (click)="confirmDelete()">–ò–∑—Ç—Ä–∏–π</button>
    </div>
  </div>
</div>
