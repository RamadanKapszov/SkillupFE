<div class="test-page" *ngIf="!submitted; else resultTpl">
  <div class="test-header">
    <h2>{{ testTitle }}</h2>
    <div class="timer">‚è±Ô∏è {{ formatTime(timeLeft) }}</div>
  </div>
  <div class="questions">
    <div class="question-card" *ngFor="let q of questions; let i = index">
      <h4>{{ i + 1 }}. {{ q.text }}</h4>

      <!-- üü¢ SINGLE -->
      <div class="options" *ngIf="q.type === 'single'">
        <label
          *ngFor="let opt of q.options"
          [class.selected]="answers[q.id] === opt"
        >
          <input
            type="radio"
            name="q{{ q.id }}"
            [value]="opt"
            (change)="selectAnswer(q.id, opt)"
          />
          {{ opt }}
        </label>
      </div>

      <!-- üîµ MULTIPLE -->
      <div class="options" *ngIf="q.type === 'multiple'">
        <label
          *ngFor="let opt of q.options"
          [class.selected]="answers[q.id]?.includes(opt)"
        >
          <input
            type="checkbox"
            [checked]="answers[q.id]?.includes(opt)"
            (change)="toggleMultiAnswer(q.id, opt, $event)"
          />
          {{ opt }}
        </label>
      </div>

      <!-- ‚úèÔ∏è TEXT -->
      <div class="options" *ngIf="q.type === 'text'">
        <input
          type="text"
          placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –æ—Ç–≥–æ–≤–æ—Ä–∞ —Å–∏..."
          [(ngModel)]="answers[q.id]"
        />
      </div>
    </div>
  </div>

  <div class="actions">
    <button class="btn gradient" (click)="submitTest()">üì© –ü—Ä–µ–¥–∞–π —Ç–µ—Å—Ç–∞</button>
  </div>
</div>

<ng-template #resultTpl>
  <div class="test-result">
    <h2>–†–µ–∑—É–ª—Ç–∞—Ç</h2>
    <div class="score">
      üéØ <strong>{{ score }}%</strong>
    </div>
    <p *ngIf="score >= 80" class="success">–û—Ç–ª–∏—á–Ω–∞ —Ä–∞–±–æ—Ç–∞!</p>
    <p *ngIf="score < 80 && score >= 50" class="good">–î–æ–±—Ä–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—è–Ω–µ!</p>
    <p *ngIf="score < 50" class="fail">–ú–æ–∂–µ –∏ –ø–æ-–¥–æ–±—Ä–µ —Å–ª–µ–¥–≤–∞—â–∏—è –ø—ä—Ç!</p>

    <button class="btn primary" (click)="goBackToLesson()">
      ‚Üê –ù–∞–∑–∞–¥ –∫—ä–º —É—Ä–æ–∫–∞
    </button>
  </div>
</ng-template>
