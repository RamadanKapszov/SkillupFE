<div class="course-details-container" *ngIf="!loading && course">
  <!-- üñºÔ∏è Hero Section -->
  <section class="course-hero">
    <img
      [src]="course.imageUrl || 'assets/images/default-course.jpg'"
      alt="{{ course.title }}"
      class="course-hero-bg"
    />
    <div class="course-hero-overlay"></div>

    <div class="course-hero-content">
      <h1 class="course-title">{{ course.title }}</h1>

      <div class="course-meta">
        <span *ngIf="course.categoryName" class="meta-item"
          >üè∑Ô∏è {{ course.categoryName }}</span
        >
        <span class="meta-item"
          >üë®‚Äçüè´ {{ course.teacherUsername || "–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª" }}</span
        >
        <span class="meta-item"
          >üìÖ {{ course.createdAt | date : "dd.MM.yyyy" }}</span
        >
      </div>
    </div>
  </section>

  <div class="course-main-layout">
    <!-- üßæ LEFT COLUMN (Main Content) -->
    <div class="course-main-content">
      <!-- üß† Overview -->
      <section class="course-overview fade-in">
        <h2>üéØ –ö–∞–∫–≤–æ —â–µ –Ω–∞—É—á–∏—à</h2>

        <ul>
          <li *ngIf="course.whatYouWillLearn; else defaultLearn">
            {{ course.whatYouWillLearn }}
          </li>
        </ul>

        <ng-template #defaultLearn>
          <ul>
            <li>‚úÖ –û—Å–Ω–æ–≤–∏ –Ω–∞ {{ course.title }}</li>
            <li>‚úÖ –†–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª–Ω–∏ –ø—Ä–æ–µ–∫—Ç–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</li>
            <li>‚úÖ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ—Ä–∏ –∏ –¥–µ–º–æ –∫–æ–¥</li>
            <li>‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞ –∏–Ω—Ç–µ—Ä–≤—é –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</li>
          </ul>
        </ng-template>
      </section>

      <!-- üìò About -->
      <section class="course-description fade-in">
        <h2>üìò –ó–∞ –∫—É—Ä—Å–∞</h2>
        <p>{{ course.description }}</p>

        <div *ngIf="course.prerequisites" class="info-block">
          <h3>üß∞ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª–Ω–∏ –∑–Ω–∞–Ω–∏—è</h3>
          <p>{{ course.prerequisites }}</p>
        </div>

        <div *ngIf="course.whoIsFor" class="info-block">
          <h3>üë§ –ü–æ–¥—Ö–æ–¥—è—â –∑–∞</h3>
          <p>{{ course.whoIsFor }}</p>
        </div>
      </section>

      <!-- üìà Progress -->
      <section
        class="progress-section fade-in"
        *ngIf="course?.isEnrolled && totalLessons > 0"
      >
        <h3>üìà –¢–≤–æ—è—Ç –Ω–∞–ø—Ä–µ–¥—ä–∫</h3>
        <p class="progress-info">
          {{ completedLessons }}/{{ totalLessons }} —É—Ä–æ–∫–∞ ({{
            progressPercent | number : "1.0-0"
          }}%)
        </p>

        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercent"></div>
        </div>

        <p *ngIf="progressPercent < 100" class="progress-tip">
          –ü—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π –Ω–∞–ø—Ä–µ–¥, –∑–∞ –¥–∞ –∑–∞–≤—ä—Ä—à–∏—à –∫—É—Ä—Å–∞! üöÄ
        </p>
        <p *ngIf="progressPercent === 100" class="progress-complete">
          üéâ –û—Ç–ª–∏—á–Ω–∞ —Ä–∞–±–æ—Ç–∞! –ó–∞–≤—ä—Ä—à–∏ –∫—É—Ä—Å–∞ —É—Å–ø–µ—à–Ω–æ!
        </p>
      </section>

      <!-- üìö Lessons -->
      <section class="lessons-section fade-in" *ngIf="!lessonsLoading">
        <h2>üìö –£—Ä–æ—Ü–∏ –≤ –∫—É—Ä—Å–∞</h2>

        <div class="lessons-grid">
          <div
            class="lesson-card"
            *ngFor="let l of lessons"
            [class.locked]="!course?.isEnrolled"
            (click)="course?.isEnrolled && viewLesson(l.id)"
          >
            <div class="lesson-header">
              <div class="lesson-icon">
                {{ course?.isEnrolled ? "üé•" : "üîí" }}
              </div>
              <div class="lesson-info">
                <h3>{{ l.title }}</h3>
                <p class="lesson-desc">{{ l.description || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏–µ" }}</p>
              </div>
            </div>

            <div class="lesson-footer">
              <span class="lesson-number">#{{ l.orderIndex }}</span>
              <button class="view-btn" [disabled]="!course?.isEnrolled">
                <span *ngIf="course?.isEnrolled">üé¨ –ü—Ä–µ–≥–ª–µ–¥–∞–π</span>
                <span *ngIf="!course?.isEnrolled">üîí –ó–∞–∫–ª—é—á–µ–Ω</span>
              </button>
            </div>
          </div>
        </div>

        <div *ngIf="!course?.isEnrolled" class="lessons-locked-hint">
          <p>
            üîí –ù—è–∫–æ–∏ —É—Ä–æ—Ü–∏ —Å–∞ –∑–∞–∫–ª—é—á–µ–Ω–∏. –ó–∞–ø–∏—à–∏ —Å–µ, –∑–∞ –¥–∞ –ø–æ–ª—É—á–∏—à –¥–æ—Å—Ç—ä–ø –¥–æ —Ç—è—Ö!
          </p>
          <button class="enroll-btn" (click)="enroll()">
            üéì –ó–∞–ø–∏—à–∏ —Å–µ —Å–µ–≥–∞
          </button>
        </div>
      </section>
    </div>

    <!-- üéì RIGHT SIDEBAR -->
    <aside class="course-sidebar">
      <div class="sidebar-card">
        <img
          [src]="course.imageUrl || 'assets/images/default-course.jpg'"
          alt="{{ course.title }}"
          class="sidebar-image"
        />

        <div class="sidebar-info">
          <p><strong>üéì –ù–∏–≤–æ:</strong> {{ course.level || "–ù–∞—á–∏–Ω–∞–µ—â–∏" }}</p>
          <p>
            <strong>‚è±Ô∏è –ü—Ä–æ–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ—Å—Ç:</strong>
            {{ course.duration || "8 —á–∞—Å–∞" }}
          </p>
          <p><strong>üåê –ï–∑–∏–∫:</strong> {{ course.language || "–ë—ä–ª–≥–∞—Ä—Å–∫–∏" }}</p>
          <p><strong>‚≠ê –û—Ü–µ–Ω–∫–∞:</strong> {{ course.rating || 4.8 }}/5</p>
          <p><strong>üë• –°—Ç—É–¥–µ–Ω—Ç–∏:</strong> {{ course.studentsCount || 0 }}</p>
        </div>

        <button
          class="enroll-btn full-width"
          [class.enrolled]="course?.isEnrolled"
          (click)="toggleEnrollment()"
        >
          {{ course?.isEnrolled ? "‚¨ÖÔ∏è –û—Ç–ø–∏—à–∏ —Å–µ" : "üéì –ó–∞–ø–∏—à–∏ —Å–µ" }}
        </button>
      </div>
    </aside>
  </div>

  <!-- üåà Confirm Unenroll Modal -->
  <div
    class="confirm-modal-backdrop"
    *ngIf="showConfirmModal"
    (click)="closeConfirmModal()"
  >
    <div class="confirm-modal" (click)="$event.stopPropagation()">
      <div class="confirm-icon">‚ùì</div>
      <h3>–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ —Å–µ –æ—Ç–ø–∏—à–µ—Ç–µ?</h3>
      <p>
        –©–µ –∑–∞–≥—É–±–∏—Ç–µ –¥–æ—Å—Ç—ä–ø –¥–æ –≤—Å–∏—á–∫–∏ —É—Ä–æ—Ü–∏ –≤ –∫—É—Ä—Å–∞
        <strong>"{{ course?.title }}"</strong>.
      </p>

      <div class="confirm-actions">
        <button class="cancel-btn" (click)="closeConfirmModal()">–û—Ç–∫–∞–∂–∏</button>
        <button class="confirm-btn" (click)="confirmUnenroll()">
          –î–∞, –æ—Ç–ø–∏—à–∏ –º–µ
        </button>
      </div>
    </div>
  </div>
</div>
